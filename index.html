<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kazƒ± Oyunu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:#4a2f16;color:#fff;font-family:Arial
}
canvas{display:block;background:#6b4a2b}

/* √ºst UI */
#topUI{
  position:fixed;top:10px;left:10px;z-index:5
}
#topUI button{
  padding:8px 12px;margin-right:6px;font-size:14px
}

/* mobil kontroller */
#mobileControls{
  position:fixed;bottom:20px;left:0;right:0;
  display:none;z-index:5;text-align:center
}
#mobileControls button{
  padding:14px 16px;margin:6px;font-size:18px
}

/* kaz butonu */
#digBtn{
  position:fixed;bottom:120px;left:50%;
  transform:translateX(-50%);
  display:none;z-index:6
}

/* MEN√ú */
#menu{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.7);
  display:flex;align-items:center;justify-content:center;
  z-index:10
}
#menuPanel{
  background:#6b4a2b;
  padding:30px 40px;
  text-align:center;
  border-radius:8px
}
#menuPanel button{
  display:block;
  width:200px;
  margin:10px auto;
  padding:12px;
  font-size:18px
}

/* geri butonu */
.backBtn{
  position:fixed;top:10px;right:10px;
  z-index:6;font-size:16px;padding:8px 12px
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<!-- MEN√ú -->
<div id="menu">
  <div id="menuPanel">
    <h2>Platform Se√ß</h2>
    <button onclick="selectPlatform('pc')">üíª PC</button>
    <button onclick="selectPlatform('mobile')">üì± Mobil</button>
  </div>
</div>

<div id="topUI">
  <button onclick="openMuseum()">üèõÔ∏è M√ºze</button>
  <button onclick="openShop()">üõí Maƒüaza</button>
</div>

<button id="digBtn" onclick="digAttempt()">‚õèÔ∏è Kaz</button>

<div id="mobileControls">
  <button ontouchstart="move.left=true" ontouchend="move.left=false">‚¨ÖÔ∏è</button>
  <button ontouchstart="move.right=true" ontouchend="move.right=false">‚û°Ô∏è</button>
  <button ontouchstart="move.up=true" ontouchend="move.up=false">‚¨ÜÔ∏è</button>
  <button ontouchstart="move.down=true" ontouchend="move.down=false">‚¨áÔ∏è</button>
</div>

<button id="backBtn" class="backBtn" style="display:none" onclick="backToGame()">‚¨ÖÔ∏è Geri</button>

<script>
/* ================= CANVAS ================= */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
addEventListener("resize",resize);
resize();

/* ================= DURUMLAR ================= */
let gameState="menu"; // menu, play, dig, museum, shop
let controlType="pc";

/* ================= HAREKET ================= */
const move={left:false,right:false,up:false,down:false};

/* ================= OYUNCU ================= */
const player={x:200,y:100,size:32,speed:4};
let cameraY=0;

/* ================= EKONOMƒ∞ ================= */
let money=0;
let rarityBonus=0;
let sellBonus=0;
let digPrecision=0;

/* ================= M√úZE & MAƒûAZA ================= */
const museum=[];
const shopItems=[
 {name:"+%5 Nadirlik",cost:50,buy:()=>rarityBonus+=5},
 {name:"Kazƒ± Hassasiyeti",cost:40,buy:()=>digPrecision+=15},
 {name:"Satƒ±≈ü +10 $A",cost:60,buy:()=>sellBonus+=10}
];

/* ================= ESERLER ================= */
const artifacts=[
 {x:120,y:500,done:false},
 {x:260,y:900,done:false},
 {x:180,y:1400,done:false}
];

function rollRarity(y){
 let r=Math.random()*100+rarityBonus;
 if(y<600) return r<80?{n:"Sƒ±radan",c:"blue",v:10}:{n:"Epic",c:"purple",v:30};
 if(y<1200){
  if(r<60) return {n:"Epic",c:"purple",v:30};
  if(r<90) return {n:"Sƒ±radan",c:"blue",v:10};
  return {n:"Efsanevi",c:"gold",v:100};
 }
 return r<70?{n:"Epic",c:"purple",v:30}:{n:"Efsanevi",c:"gold",v:100};
}
artifacts.forEach(a=>a.rarity=rollRarity(a.y));

/* ================= KAZI ================= */
let activeArtifact=null;
let barPos=200,barDir=1,digTries=0;

function startDig(a){
 activeArtifact=a;
 gameState="dig";
 digTries=0;
 document.getElementById("digBtn").style.display="block";
}

function getZone(pos){
 const g1=180-digPrecision/2,g2=220+digPrecision/2;
 if(pos>g1&&pos<g2)return"green";
 if(pos>140&&pos<260)return"yellow";
 return"red";
}

function digAttempt(){
 const z=getZone(barPos);
 if(z==="green"){collect();closeDig()}
 else if(z==="yellow"){
  digTries++; if(digTries>=2){breakArt();closeDig()}
 }
 else{breakArt();closeDig()}
}

function collect(){
 museum.push(activeArtifact.rarity);
 money+=activeArtifact.rarity.v+sellBonus;
 activeArtifact.done=true;
}
function breakArt(){activeArtifact.done=true}
function closeDig(){
 gameState="play";
 activeArtifact=null;
 document.getElementById("digBtn").style.display="none";
}

/* ================= KONTROLLER ================= */
document.addEventListener("keydown",e=>{
 if(controlType!=="pc")return;
 if(e.key==="ArrowLeft")move.left=true;
 if(e.key==="ArrowRight")move.right=true;
 if(e.key==="ArrowUp")move.up=true;
 if(e.key==="ArrowDown")move.down=true;
 if(e.key===" "&&gameState==="dig")digAttempt();
});
document.addEventListener("keyup",e=>{
 if(controlType!=="pc")return;
 if(e.key==="ArrowLeft")move.left=false;
 if(e.key==="ArrowRight")move.right=false;
 if(e.key==="ArrowUp")move.up=false;
 if(e.key==="ArrowDown")move.down=false;
});

/* ================= UI FONKS ================= */
function selectPlatform(t){
 controlType=t;
 document.getElementById("menu").style.display="none";
 if(t==="mobile")document.getElementById("mobileControls").style.display="block";
 gameState="play";
}
function openMuseum(){
 gameState="museum";
 document.getElementById("backBtn").style.display="block";
}
function openShop(){
 gameState="shop";
 document.getElementById("backBtn").style.display="block";
}
function backToGame(){
 gameState="play";
 document.getElementById("backBtn").style.display="none";
}

/* ================= UPDATE ================= */
function update(){
 if(gameState!=="play")return;
 if(move.left)player.x-=player.speed;
 if(move.right)player.x+=player.speed;
 if(move.up)player.y-=player.speed;
 if(move.down)player.y+=player.speed;
 cameraY=player.y-canvas.height/2;
}

/* ================= DRAW ================= */
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 if(gameState==="play"||gameState==="dig"){
  ctx.fillStyle="blue";
  ctx.fillRect(player.x,player.y-cameraY,player.size,player.size);

  artifacts.forEach(a=>{
   if(a.done)return;
   ctx.fillStyle=a.rarity.c;
   ctx.fillRect(a.x,a.y-cameraY,30,30);
   if(gameState==="play"&&Math.abs(player.x-a.x)<30&&Math.abs(player.y-a.y)<30){
    startDig(a);
   }
  });

  ctx.fillStyle="#fff";
  ctx.fillText("üí∞ "+money+" $A",20,30);
 }

 if(gameState==="dig"){
  barPos+=barDir*4;
  if(barPos>300||barPos<100)barDir*=-1;

  ctx.fillStyle="#222";
  ctx.fillRect(canvas.width/2-150,canvas.height/2-10,300,20);
  ctx.fillStyle="red";
  ctx.fillRect(canvas.width/2-150,canvas.height/2-10,60,20);
  ctx.fillRect(canvas.width/2+90,canvas.height/2-10,60,20);
  ctx.fillStyle="yellow";
  ctx.fillRect(canvas.width/2-90,canvas.height/2-10,180,20);
  ctx.fillStyle="green";
  ctx.fillRect(canvas.width/2-40-digPrecision/2,canvas.height/2-10,80+digPrecision,20);
  ctx.fillStyle="#fff";
  ctx.fillRect(canvas.width/2-150+barPos-100,canvas.height/2-15,4,30);
 }

 if(gameState==="museum"){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.fillText("üèõÔ∏è M√ºze",canvas.width/2-40,40);
  museum.forEach((e,i)=>{
   ctx.fillStyle=e.c;
   ctx.fillText(e.n+" ("+e.v+"$)",80,80+i*30);
  });
 }

 if(gameState==="shop"){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.fillText("üõí Maƒüaza",canvas.width/2-50,40);
  shopItems.forEach((s,i)=>{
   ctx.fillText(s.name+" - "+s.cost+"$A",60,100+i*40);
  });
 }
}

/* ================= MAƒûAZA TIK ================= */
canvas.addEventListener("click",()=>{
 if(gameState==="shop"){
  shopItems.forEach(s=>{
   if(money>=s.cost){money-=s.cost;s.buy()}
  });
 }
});

/* ================= LOOP ================= */
function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>